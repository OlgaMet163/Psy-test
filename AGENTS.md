# Правила для агентов

## Общие принципы
- Всегда работать на русском языке, если не указано иначе.
- Не менять файлы без явного подтверждения пользователя.
- Документировать предположения и источники данных.

## Перед внесением изменений
- Сверять действия с последними инструкциями пользователя и незавершёнными задачами.
- Сообщать о планируемых действиях и ждать подтверждения (если требуется).

## Перед обработкой запросов
- Проверять актуальность правил и ограничения безопасности.
- Убедиться, что входящие данные допустимы (без ПД, если нет согласия).
- Напоминать: результаты тестов — не клинический диагноз.

## Работа с ботом
- Меню только inline: порядок кнопок — «Начать» → «Результаты» → «Перепройти» для каждого теста; параллельные тесты запрещены.
- Вопросы поддерживают кнопку «Назад»: можно вернуться, увидеть выбранный вариант (галочка) и сменить ответ; в БД хранится последний ответ на утверждение.
- `/reset` очищает ответы/результаты/почту пользователя и возвращает стартовое меню.
- Хранение: SQLite `data/bot.db` через `StorageGateway`; таблицы `hexaco_answers`, `hexaco_results`, `participant_emails`; состояние FSM — `MemoryStorage`.
- Радар-диаграммы (Big Five, Hogan, SVS, Тёмная триада) строятся на matplotlib; при сбоях отправлять текст без падений.
- Команда `teamswitch` (или текст) переводит в режим сотрудника, доступна только кнопка «Посмотреть участника».
- IM показываем только сотруднику; для участника IM скрыт.
- Не выводить системные/информационные сообщения, о которых явно не просил пользователь.

## Контроль качества
- После изменений проверять соответствие требованиям.
- Фиксировать версии методик и формул расчёта.
- Запускать тесты/линтеры после значимых правок (pytest доступен).

